<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include the Quill library -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <title>Step 2</title>
</head>

<body>
    <div id="app">
        <h1>AIB Step 2</h1>
        <label for="aib_input">Input:</label>
        <input type="text" id="aib_input" name="aib_input" value="{{ aib_input }}" ref="aib_input" readonly>
        <button @click="copyText('aib_input')">Copy</button>
        <br>
        <br>
        <br>
        <br>
        <input type="submit" value="Submit" @click="pasteAndSubmit">
    </div>
    <label for="aib_output">OUTPUT</label>
    <div id="editor">
    </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
<script>
    const { createApp, ref, toRefs } = Vue;
    const csrftoken = '{{ csrf_token }}';
    const quill = new Quill('#editor', {
        theme: 'snow'
    });
    createApp({
        setup() {
            const url = window.location.href;
            const uuid = window.location.href.split('/');
            const aib_input = ref(null);
            const aib_output = ref('');
            const copyText = (value) => {
                switch (value) {
                    case 'aib_input':
                        aib_input.value.select();
                        document.execCommand('copy');
                        break;
                    default:
                        console.log('Invalid value');
                }
            };
            const pasteAndSubmit = () => {
                var html = quill.root.innerHTML;
                axios.put('/api/aib_exam/' + uuid[4] + '/', {
                    aib_final_result: html,
                    step_2: true,
                }, {
                    headers: {
                        'X-CSRFToken': csrftoken
                    }
                }).then(response => {
                    if (response.status === 200) {
                        window.location.href = response.request.responseURL;
                    }
                }).catch(error => {
                    console.error(error);
                });
            };

            return {
                ...toRefs({
                    copyText,
                    pasteAndSubmit,
                }),
                aib_input,
                aib_output,
            };
        },
    }).mount('#app');
</script>


</html>